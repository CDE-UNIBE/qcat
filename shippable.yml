# Shippable CI/CD configuration file.
# http://docs.shippable.com/en/latest/config.html#configuration
language:
  python

python:
  - 3.6

env:
  global:
    - secure: qTVKZ652+t60ZvqF3+PAhniR+OFhiu9RwpujYcFYj6nRGTAjq/X/w8ch5bpCNMblHSZjTZGCxS9ydAtIv+koLk2Y5sQgn3z+PbcmXOXT0Ntj2uei/rs1BoFLR3wfMpqjmp/73T4PtddG/gVRBb2OkrPj+dsl+K5GEyW0CYz2tDvmDf7yl386LtEmpqtQJrSM6eswfTFIqEW7P0kD12FaCaS2xJXxkgAOnGJGfyfELf7lQyKD1v7Ty7oeQHWihbcrr+zP6A/9QMnh3awQmGxda9BwfCSPESX3aUeUrgdNnI12yS+EvDIzU06IHyrHa0gWy6Av5ew01wqJQxWRscg7ikZVcPzrDHmmb2EHHohoAMs/fuVPb5GKMk0prOyjzqzIEEMjlApf8wavZPjkLQ6tjrTqzrcwMN9NQJVTgwtojwdMUP1MW43UGrxjxxI7NBmuqIzTViHG3ocuxPEBTBn9sHZVS55NUiD/+v99qPdHxC6J/epD7NRyvtomis/UZbWHcSINWVlLeJ2q4617h3xANl/DFY+bS7VxVTeFnhlVYr7eii+hKOPCZH6IbftJJ+vpososuzSHDnsEOROrn1UTr6clkOMNm7kRLMEchiYgu9/GXrQGpuhFPtATQRCqOAJEqQiimwU48L2qSphphQl3GFmK/uGDQtgc5ye48S2sDNs=

build:
  pre_ci_boot:
    image_name: drydock/u16pytall
    image_tag: v5.5.3

  ci:
    - export LC_ALL=C
    - sudo apt-get update && sudo apt-get -y install python3-pip libjpeg-dev libjpeg8-dev binutils libproj-dev gdal-bin
    - echo "`pwd`/apps" > `python3 -c "from distutils.sysconfig import get_python_lib; print(get_python_lib())"`/_qcat_path.pth
    - echo "ProdDefaultSite" > envs/DJANGO_CONFIGURATION
    - echo "qcat.settings" > envs/DJANGO_SETTINGS_MODULE
    - echo "postgis://qcat:123456@localhost:5432/qcat" > envs/DATABASE_URL
    - echo "123" > envs/DJANGO_SECRET_KEY
    - pip3 install -r requirements/development.txt
    - pip3 install -r requirements/production.txt
    - unset LC_ALL

  on_success:
    - fab deploy:$BRANCH

  cache: true

branches:
  only:
    - develop
    - master

integrations:
  notifications:
    - integrationName: slack-integration
      type: slack
      recipients:
        - "#server-info"
      on_success: always
      on_failure: always

    - integrationName: email
      type: email
      on_success: never
      on_failure: never
      on_pull_request: never
