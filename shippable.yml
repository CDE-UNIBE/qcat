# Shippable CI/CD configuration file.
# http://docs.shippable.com/en/latest/config.html#configuration
language:
  python

python:
  - 3.6

env:
  global:
    - secure: LIHBov0S5LSlk2yQLm7XnhqgyOAY3yVoxYkYlClRHVFq2EgqQ3bNyzCRCBNFPmsGAF43ai2ZjcdiqGbJCDv9Psbf20+WC/1sF3MWRV4iOVtg8blQp62eTzksn1Wgl+Mv6ZmX6IPecaAjP3ChQzEx+RRKoUrAuhWtEyTkVE/MwCKObGW8F1vSORycu5PZxfBSO5NK4yOtkxKv7evH/tKYdcwEWkgT9dktTatFA4YhotUp1gEL0PBHl5B5EOPAkbioAmrTmP4omF7AVFUWTS4QFf+T1VPnxpoRuETtu0Rx/xkNYe4KI+6d3L715hY8mlDB1qJeNVA6iSfvqk5+A/lo34/b6Tmyh48O0lY3eFsLJWPV/Ik5OqmjIox+/H6oGRVKmIep/AN90bhPOJ3kqlOlRg4SmZFHsO0e+Na+9fS46zNNeJqIHDbAGRW3v18AbgbcEQuBL1Fm71BJY0vWLJTBs1RK5h0QYHVoPSPCN3Yl9y4Lqee5R33msZcfQj5DoYwM/VXLwc7eo1yOkQfF8gSceuR+qWuoFP0zcTW6DAIBahC/JYxa+cQy61Yy88vCOdY7X1wkGEqeh4dPAJdHM5PFRRTZKXXa1EVQvX+WR8kqwhi7AcFvOboce50XAPqZhU0lEqbQsAXxqB0xhJ/C0exocmgTfSDMtRF9vtsFDbYfTM+KUcvSwQVg2Ta8/nVT0uwin9ajj+3djZjtubSjPykQNEBmfJg0ONmQfIO4QDZdM53WIt+hBfktqWSawYyIlLd1aaXiIClafbVwiaOuAl4tBKxIATFpzHsCswp8Ii7x6eE4zctdmXrjOqqXL5Wojn2y4jXW8Io8AO3F9iTtPhJpR23Pr3FQQflyvvjxzzzoKcITFR/Te6ijqHdZgBXO7az0snRFefnzEnp4GuFSG3UeJ5R59vxvdLBYNsbpmjRoLqSE+IGBbzkgO9YaMbSVZx7KWPXEd6b7+4pzrdsM8RkNqfR3ge/8C0UZJzHQ3d45bLCW8Buyfc6/QcNuZCB6MCl5

build:
  pre_ci_boot:
    image_name: drydock/u16pytall
    image_tag: v5.5.3

  ci:
    - export LC_ALL=C
    - sudo apt-get update && sudo apt-get -y install python3-pip libjpeg-dev libjpeg8-dev binutils libproj-dev gdal-bin
    - echo "`pwd`/apps" > `python3 -c "from distutils.sysconfig import get_python_lib; print(get_python_lib())"`/_qcat_path.pth
    - echo "ProdDefaultSite" > envs/DJANGO_CONFIGURATION
    - echo "qcat.settings" > envs/DJANGO_SETTINGS_MODULE
    - echo "postgis://qcat:123456@localhost:5432/qcat" > envs/DATABASE_URL
    - echo "123" > envs/DJANGO_SECRET_KEY
    - pip3 install -r requirements/development.txt
    - pip3 install -r requirements/production.txt
    - unset LC_ALL

  on_success:
    - fab deploy:$BRANCH

  cache: true

branches:
  only:
    - develop
    - master

integrations:
  notifications:
    - integrationName: slack-integration
      type: slack
      recipients:
        - "#server-info"
      on_success: never
      on_failure: never

    - integrationName: email
      type: email
      on_success: never
      on_failure: never
      on_pull_request: never
