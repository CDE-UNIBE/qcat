# Shippable CI/CD configuration file.
# http://docs.shippable.com/en/latest/config.html#configuration
language:
  python

python:
  - 3.5

env:
  global:
    - secure: cXlr47zgwD8hOiJkbNJVg7FfOaTS6cjbV+IVK4WHccSM5TUuqN7ee5N6Eg1F+MANiwG2hAiabeH7c3h7omGU6T9Zrm/ysCmAS8o6V5gaLfdOnj0mcZr7a6ZmOHicOH6EKd2o3EhN4TzIkPk8Pe4CeCAiXzA47ennyCG9Nlv0Mp/mCu3fU1U1R/2Xb3eIEXM/Mg4T6aZjlilngrUtffo4qBQ7mzC+bPr/lQDIYEJJbDr0fMZvd5q6XC2Mlid06dLFLXXiceVB0Q1BRL2bMOnwrcj+nPaah1KG/i35AfmXjHw5+zQrRJ2diD4BRn6dPNFzO1Ap6Aa904ZHiJejFaG6XRSEb+/u1vvFICoThpRgGcRAgTHiEhKCLBPr1HEa86KRKW04jyst2r5DiFuiftdPNJ/rju0a0acsp9Nujf6Txqz4llGBfoJw2tSe7qbpPBOMDFGcqhwRQuYmjGO46plr9JxcFzmUBlJCU1k8agd0NPpgfYxX8cSSyUL3pDs2nmUG3uLV7VfGb7CKjpjnKU30zGA4+UWWlhUcK+nYJU2AZ5CwD6LKJdEG/8xPzUkmxAo/dSNf8wMpBzd3yr+qRIfUbE0zgUtEYw7vx8AGAHOFett+4n5lrZrcfuKJjLRvWoVWeBqhUddsEaSJ071VN6Hj6O3u3lPa1VXH05yJgmRmQzE=

build:
  pre_ci_boot:
    image_name: drydock/u16pytall
    image_tag: tip

  ci:
    - export LC_ALL=C
    - sudo apt-get update && sudo apt-get -y install python3-pip libjpeg-dev libjpeg8-dev binutils libproj-dev gdal-bin
    - echo "`pwd`/apps" > `python3 -c "from distutils.sysconfig import get_python_lib; print(get_python_lib())"`/_qcat_path.pth
    - echo "ProdDefaultSite" > envs/DJANGO_CONFIGURATION
    - echo "qcat.settings" > envs/DJANGO_SETTINGS_MODULE
    - echo "postgis://qcat:123456@localhost:5432/qcat" > envs/DATABASE_URL
    - echo "123" > envs/DJANGO_SECRET_KEY
    - pip3 install -r requirements/development.txt
    - pip3 install -r requirements/production.txt
    - unset LC_ALL

  on_success:
    - fab deploy:$BRANCH

  cache: true

branches:
  only:
    - develop
    - master

integrations:
  notifications:
    - integrationName: slack-integration
      type: slack
      recipients:
        - "#server-info"
      on_success: always
      on_failure: always

    - integrationName: email
      type: email
      on_success: never
      on_failure: never
      on_pull_request: never
