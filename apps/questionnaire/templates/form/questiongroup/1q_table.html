{% comment %}

  A table with 2 columns, each cell containing a question. If there are more
  than 2 questions, additional rows are created.Table headers are only created
  for the first 2 questions!

  No buttons to add or remove additional questiongroups!

  config: The configuration of the questiongroup

  formset: The (repeating) forms as formset

{% endcomment %}

{% load i18n %}
{% load floppyforms %}
{% load list_to_columns %}

<div{% if config.questiongroup_condition %} id="{{ config.questiongroup_condition }}"{% endif %} class="questiongroup{% if config.numbered %} questiongroup-numbered-{{ config.numbered }}{% endif %}{% if config.numbered == 'prefix' %} sortable{% endif %}">
{{ formset.management_form }}

{% for qg_form in formset.forms %}

  <div class="list-item row">
    {# First question #}
    <div class="small-3 columns">
      {% for field in qg_form.visible_fields %}
        {% if forloop.first %}
          {% with template=config.templates|get_by_keyword:field.name options=config.options|get_by_keyword:field.name %}
            {% if template %}
              {% formrow field using template %}
            {% else %}
              {% formrow field using "form/question/default.html" %}
            {% endif %}
          {% endwith %}
        {% endif %}
      {% endfor %}
    </div>
    {# Other questions: As table #}
    <div class="small-9 columns">
      <table>
        <thead>
          <tr>
            {% for field in qg_form.visible_fields %}
              {% if forloop.counter > 1 %}
                <th>{{ field.label }}</th>
              {% endif %}
            {% endfor %}
          </tr>
        </thead>
        <tbody>
          <tr>
            {% for field in qg_form.visible_fields %}
              {% if forloop.counter > 1 %}
                <td>
                  {% formrow field using "form/question/no_label.html" %}
                </td>
              {% endif %}
            {% endfor %}
          </tr>
        </tbody>
      </table>
    </div>
  </div>



{#        <thead>#}
{#          {% for field in qg_form.visible_fields %}#}
{##}
{#            {% if forloop.counter == 1 %}#}
{#              <tr>#}
{#            {% endif %}#}
{##}
{#            {% if forloop.counter <= table_columns %}#}
{#              <th>{{ field.label }}</th>#}
{#            {% endif %}#}
{##}
{#            {% if forloop.counter == table_columns %}#}
{#              </tr>#}
{#            {% endif %}#}
{##}
{#          {% endfor %}#}
{#        </thead>#}
{#        <tbody>#}
{#          {% for field in qg_form.visible_fields %}#}
{#            {% if forloop.first %}#}
{#              <tr>#}
{#            {% elif forloop.counter0|divisibleby:table_columns and not forloop.last %}#}
{#              </tr><tr>#}
{#            {% endif %}#}
{##}
{#            <td>#}
{#              {% formrow field using "form/question/no_label.html" %}#}
{#            </td>#}
{##}
{#            {% if forloop.last %}#}
{#              </tr>#}
{#            {% endif %}#}
{#          {% endfor %}#}
{#        </tbody>#}
{#      {% endfor %}#}


{% endfor %}
</div>

{#{% with table_columns=config.table_columns %}#}
{#  <div{% if config.questiongroup_condition %} id="{{ config.questiongroup_condition }}"{% endif %} class="questiongroup{% if config.numbered %} questiongroup-numbered-{{ config.numbered }}{% endif %}{% if config.numbered == 'prefix' %} sortable{% endif %}">#}
{#  {{ formset.management_form }}#}
{#    <table>#}
{#      {% for qg_form in formset.forms %}#}
{#        <thead>#}
{#          {% for field in qg_form.visible_fields %}#}
{##}
{#            {% if forloop.counter == 1 %}#}
{#              <tr>#}
{#            {% endif %}#}
{##}
{#            {% if forloop.counter <= table_columns %}#}
{#              <th>{{ field.label }}</th>#}
{#            {% endif %}#}
{##}
{#            {% if forloop.counter == table_columns %}#}
{#              </tr>#}
{#            {% endif %}#}
{##}
{#          {% endfor %}#}
{#        </thead>#}
{#        <tbody>#}
{#          {% for field in qg_form.visible_fields %}#}
{#            {% if forloop.first %}#}
{#              <tr>#}
{#            {% elif forloop.counter0|divisibleby:table_columns and not forloop.last %}#}
{#              </tr><tr>#}
{#            {% endif %}#}
{##}
{#            <td>#}
{#              {% formrow field using "form/question/no_label.html" %}#}
{#            </td>#}
{##}
{#            {% if forloop.last %}#}
{#              </tr>#}
{#            {% endif %}#}
{#          {% endfor %}#}
{#        </tbody>#}
{#      {% endfor %}#}
{#    </table>#}
{#  </div>#}
{#{% endwith %}#}
